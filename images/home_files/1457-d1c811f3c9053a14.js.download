!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="702b4751-1928-4e2b-aa8f-a05c8a682913",e._sentryDebugIdIdentifier="sentry-dbid-702b4751-1928-4e2b-aa8f-a05c8a682913")}catch(e){}}();var _global="undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{};_global.SENTRY_RELEASE={id:"15e16f7d"},(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1457],{31146:function(e,n,t){"use strict";t.d(n,{ck:function(){return s},dp:function(){return f},he:function(){return l},js:function(){return c},mZ:function(){return u}});var r=t(19499),o=t(97807),i=t(14224),a=t(91620).lW,s=i.env.PROXY_SUFFIX||"repl.co",c=i.env.PROXY_FIREWALL_SUFFIX||"firewalledreplit.co";function l(e){var n=e.split(".");if(4!==n.length)throw new Error("Invalid token: should have exactly 4 parts: "+e);for(var t=n[2].replace(/-/g,"+").replace(/_/g,"/");t.length%4;)t+="=";var o=window.atob(t);if(o.length<64)throw new Error("Invalid token: signed part is too short: "+o.length);var i=o.substring(0,o.length-64);return r.api.ReplToken.decode(new a(i,"base64"))}function u(e){return-1!==e.indexOf("repl.localhost:8080")?"ws:":"wss:"}function f(e){var n=l(e).repl.id,t=(0,o.Z)()?c:s,r=u(t),i="".concat(n,".id");return"".concat(r,"//").concat(i,".").concat(t)}},20643:function(e,n,t){"use strict";t.d(n,{Z:function(){return u},t:function(){return l}});var r=t(57135),o=t(96583),i=t(74906),a=(t(45005),t(49500));function s(){return c.apply(this,arguments)}function c(){return(c=(0,r.Z)((function(){return(0,o.__generator)(this,(function(e){return i.Z.get("gurl")?(a.log("Getting gurl from localstorage"),[2,i.Z.get("gurl")]):[2,null]}))}))).apply(this,arguments)}function l(e){var n=function(e){var n;try{n=new URL(e)}catch(r){return a.log("failed to parse gurl"),a.error(r),null}var t={secure:!1,port:""+n.port,host:n.hostname};return"wss:"===n.protocol?t.secure=!0:"ws:"!==n.protocol&&a.log(e,"Expected gurl protocol to be ws or wss, assuming insecure connection"),t.port||(t.port=t.secure?"443":"80"),t}(e);if(!n)return null;var t=n.secure,r=n.host,o=n.port;return"eval.repl.it"===r||"gp-v2.replit.com"===r||"gp-v2.firewalledreplit.com"===r||"eval.replit.com"===r?null:{id:"development",gurl:"ws".concat(t?"s":"","://").concat(r,":").concat(o),conmanURL:"http".concat(t?"s":"","://").concat(r,":").concat(o),proxy:"http".concat(t?"s":"","://").concat(r.replace("eval","proxy"),":").concat(o)}}function u(){return f.apply(this,arguments)}function f(){return(f=(0,r.Z)((function(){var e;return(0,o.__generator)(this,(function(n){switch(n.label){case 0:return[4,s()];case 1:return(e=n.sent())?[2,l(e)]:[2,null]}}))}))).apply(this,arguments)}},23023:function(e,n,t){"use strict";t.d(n,{C:function(){return c},D:function(){return s}});var r=t(43119),o=t(71440);function i(){var e=(0,r.Z)(["\n  fragment CrosisContextCurrentUser on CurrentUser {\n    id\n    username\n    isSubscribed\n    roles {\n      id\n      name\n    }\n  }\n"]);return i=function(){return e},e}function a(){var e=(0,r.Z)(["\n  fragment CrosisContextRepl on Repl {\n    id\n    language\n    slug\n    user {\n      id\n      username\n    }\n    currentUserPermissions {\n      containerWrite\n    }\n  }\n"]);return a=function(){return e},e}var s=(0,o.Ps)(i()),c=(0,o.Ps)(a())},33033:function(e,n,t){"use strict";t.d(n,{em:function(){return D.e},ZP:function(){return S}});var r=t(57135),o=t(96583),i=t(7131),a=t(31146);function s(){return c.apply(this,arguments)}function c(){return(c=(0,r.Z)((function(){return(0,o.__generator)(this,(function(e){return"undefined"===typeof document?[2]:document.hidden?[2,new Promise((function(e){var n=function(){document.hidden||(document.removeEventListener("visibilitychange",n),e())};document.addEventListener("visibilitychange",n)}))]:[2]}))}))).apply(this,arguments)}var l=t(20643),u=t(68241),f=t(32524),d=t(72006),h=t(4405),p=t(20854),v=t(1474),g=t(83111),m=t(90171),y=t.n(m),w=t(14224),C=Boolean(w.env.CAPTCHA_EMBEDS);function E(e){return b.apply(this,arguments)}function b(){return(b=(0,r.Z)((function(e){var n,t,r,a,s,c,l,u,f;return(0,o.__generator)(this,(function(o){switch(o.label){case 0:if(n=e.replId,t=e.isLoggedIn,r=e.overrideClusterMetadata,a=e.asViewer,s=e.retry,!p.l)throw new Error("Expected apollo client");if(c=Boolean(y().query.lite||y().query.embed),l={url:"/data/repls/".concat(n,"/get_connection_metadata"),overrideClusterMetadata:r,clientVersion:"15e16f7d",hCaptchaSiteKey:v.wE,isEmbed:c,flags:{},retry:s||0,asViewer:a,isMigratingToNix:"/migrateReplToNix"===y().pathname},t||c&&!C)return[3,4];o.label=1;case 1:return o.trys.push([1,3,,4]),[4,(0,v.ZP)()];case 2:return u=o.sent(),[2,(0,g.Z)((0,h.Z)((0,d.Z)({},l),{captcha:u}))];case 3:return f=o.sent(),i.kg.error("Goval connection failure",{errorMessage:f&&f.message||"unidentified failure",replid:n,reason:"captcha",context:"services"}),[2,E({replId:n,overrideClusterMetadata:r,retry:(s||0)+1,isLoggedIn:t,asViewer:a})];case 4:return[2,(0,g.Z)(l)]}}))}))).apply(this,arguments)}var D=t(18548);function S(e){var n=e.onUnrecoverableError,t=e.onFirewallDenied,c=function(){var e,n=function(){e&&(e(),e=void 0)};return{register:function(t,r){n();var o=t,i=r;return window.addEventListener("online",o),window.addEventListener("offline",i),e=function(){window.removeEventListener("online",o),window.removeEventListener("offline",i)},n},unregister:n}}(),d=c.register,h=c.unregister;return(0,f.ZP)({fetchConnectionMetadata:E,getOverrideClusterMetadata:l.Z,getVncUrl:a.dp,logger:i.kg,onUnrecoverableError:n,onFirewallDenied:t,performance:window.performance,preFetchConnectionMetadata:(0,r.Z)((function(){var e;return(0,o.__generator)(this,(function(n){switch(n.label){case 0:return window.performance.clearMarks(u.Iy.fetchConnectionMetadataPageInvisibleStart),window.performance.clearMarks(u.Iy.fetchConnectionMetadataPageInvisibleEnd),e=i.kg.timeStart(),window.performance.mark(u.Iy.fetchConnectionMetadataPageInvisibleStart),"/migrateReplToNix"===y().pathname?[3,2]:[4,s()];case 1:n.sent(),n.label=2;case 2:window.performance.mark(u.Iy.fetchConnectionMetadataPageInvisibleEnd),e("page visible fetch connection metadata"),n.label=3;case 3:return[2]}}))})),registerReconnectionMonitor:d,unregisterReconnectionMonitor:h})}},22011:function(e,n,t){"use strict";t.d(n,{Z:function(){return s}});var r=t(66091),o=t(57988),i=t(81962),a=t(91620).lW,s=function(){function e(n,t){if((0,r.Z)(this,e),this.asEncoding={},this.asBuffer=null,t&&"string"===typeof n)this.asEncoding[t]=n;else if(void 0===n||null===n)this.asBuffer=a.alloc(0);else if((0,i.Z)(n,a))this.asBuffer=n;else if("string"===typeof n)this.asEncoding.utf8=n;else if((0,i.Z)(n,ArrayBuffer))this.asBuffer=a.from(n);else{if((0,i.Z)(n,e))return n;(0,i.Z)(n,Uint8Array)?this.asBuffer=a.from(n):"object"!==typeof n||"object"!==typeof n.asEncoding||null===n.asEncoding||!(0,i.Z)(n.asBuffer,a)&&null!==n.asBuffer||(this.asBuffer=n.asBuffer||null,"string"===typeof n.asEncoding.base64&&(this.asEncoding={base64:n.asEncoding.base64}),"string"===typeof n.asEncoding.utf8&&(this.asEncoding={utf8:n.asEncoding.utf8}))}}var n=e.prototype;return n.toString=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"utf8";if(void 0!==this.asEncoding[e])return this.asEncoding[e];var n=this.toBuffer(),t=n.toString(e);return this.asEncoding[e]=t,t},n.toJSON=function(){return{asEncoding:{base64:this.toString("base64")},asBuffer:null}},n.toBuffer=function(){if(this.asBuffer)return this.asBuffer;for(var e in this.asEncoding){var n=this.asEncoding[e];if("string"===typeof n){var t=a.from(n,e);return this.asBuffer=t,t}}return this.asBuffer=a.alloc(0),this.asBuffer},e.from=function(n,t){return new e(n,t)},e.isBuffer=function(n){return(0,i.Z)(n,e)},(0,o.Z)(e,[{key:"length",get:function(){return void 0!==this.asEncoding.utf8?this.asEncoding.utf8.length:this.toBuffer().length}}]),e}()},8082:function(e,n,t){"use strict";t.d(n,{F:function(){return i}});var r=t(81362),o=t(87708);function i(e,n){var t=[],i=!0,a=!1,s=void 0;try{for(var c,l=(0,r.Hg)(e.toString(),n.toString())[Symbol.iterator]();!(i=(c=l.next()).done);i=!0){var u=c.value,f=u.fromA,d=u.fromB,h=u.toA,p=u.toB;f===h&&t.push({from:f,insert:n.slice(d,p)}),d===p&&t.push({from:f,to:h,insert:""}),f!==h&&d!==p&&t.push({from:f,to:h,insert:n.slice(d,p)})}}catch(v){a=!0,s=v}finally{try{i||null==l.return||l.return()}finally{if(a)throw s}}return o.as.of(t,e.length)}},20575:function(e,n,t){"use strict";t.d(n,{C:function(){return o},h:function(){return i}});var r=/^(\.env$|\.npm$|\.npm\/|__pycache__|\.cache|\.breakpoints|\.git$|\.git\/|\.upm$|\.upm\/|node_modules$|node_modules\/|_test_runner)/;function o(e){return r.test(e)}var i=[".git",".upm",".cache","__pycache__","node_modules","venv"]},97807:function(e,n,t){"use strict";t.d(n,{Z:function(){return o}});var r=t(14224);function o(){return"firewalledreplit.com"===(null===window||void 0===window?void 0:window.location.hostname)||"1"===r.env.FIREWALL_MODE}},83111:function(e,n,t){"use strict";t.d(n,{Z:function(){return p}});var r=t(57135),o=t(72006),i=t(4405),a=t(77637),s=t(96583),c=t(45005),l=t.n(c),u=t(70065),f=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/;function d(e){return!!e&&("object"===typeof e&&("token"in e&&"string"===typeof e.token&&("gurl"in e&&"string"===typeof e.gurl&&("conmanURL"in e&&"string"===typeof e.conmanURL))))}function h(e){return!!e.token.startsWith("v2.public.")||!!f.test(e.token)}function p(e){return v.apply(this,arguments)}function v(){return(v=(0,r.Z)((function(e){var n,t,r,c,f,p,v,g,m,y;return(0,s.__generator)(this,(function(s){switch(s.label){case 0:n=e.url,t=(0,a.Z)(e,["url"]),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,l()(n,{credentials:"same-origin",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest"},method:"post",body:JSON.stringify((0,i.Z)((0,o.Z)({},t),{format:"pbuf"}))})];case 2:return r=s.sent(),[3,4];case 3:throw(c=s.sent()).statusCode||(c.statusCode=504),c;case 4:return f=r.headers.get("content-type"),p=f&&f.includes("application/json"),r.ok?[3,9]:p?[4,r.json()]:[3,6];case 5:return g=s.sent(),v=g.message,[3,8];case 6:return[4,r.text()];case 7:v=s.sent(),s.label=8;case 8:throw new u.Z(v||r.statusText).setExtras((0,o.Z)({url:n},t)).setStatusCode(r.status);case 9:return p?[3,11]:[4,r.text()];case 10:throw m=s.sent(),new u.Z("Expected JSON response for connection metadata").setExtras((0,o.Z)({contentType:f,statusText:r.statusText,response:m,url:n},t)).setStatusCode(r.status);case 11:return[4,r.json()];case 12:if(!d(y=s.sent()))throw new u.Z("Invalid format for connection metadata response").setExtras((0,o.Z)({connectionMetadata:y,url:n},t));if(!h(y))throw new u.Z("Expected token to be PASETO- or base64-encoded").setExtras((0,o.Z)({connectionMetadata:y,url:n},t));return[2,y]}}))}))).apply(this,arguments)}},32524:function(e,n,t){"use strict";t.d(n,{em:function(){return v.e},ZP:function(){return D}});var r=t(57135),o=t(72006),i=t(4405),a=t(77637),s=t(9970),c=t(96583),l=t(89890),u=t.n(l),f=t(48262),d=t(43182);function h(e){return p.apply(this,arguments)}function p(){return(p=(0,r.Z)((function(e){var n,t,r;return(0,c.__generator)(this,(function(o){return n=e.client,t=e.args,r=e.env,[2,new Promise((function(e){var o=n.openChannel({service:"exec"},(function(n){var i=n.channel,a="";i.onCommand((function(e){e.output&&(a+=e.output)})),i.request({exec:{args:t,env:r}}).then((function(n){n.channelClosed?e({error:"Channel closed",output:a||null}):("open"===i.status&&o(),n.error?e({error:n.error,output:a||null}):e({output:a,error:null}))}))}))}))]}))}))).apply(this,arguments)}var v=t(18548),g=t(27327),m=t(70065),y=t(97807),w=t(67121),C=t(49500),E=Math.random()<=.1;function b(e){var n=Math.floor(500*Math.random()),t=1e3*Math.pow(2,e);return Math.min(t,3e4)+n}function D(e){var n=e.fetchConnectionMetadata,t=e.getOverrideClusterMetadata,l=e.getVncUrl,p=e.logger,D=e.onFirewallDenied,S=e.onUnrecoverableError,k=e.performance,_=e.preFetchConnectionMetadata,x=e.registerReconnectionMonitor,Z=e.unregisterReconnectionMonitor,T=e.crosisTimeout,F=(0,g.ZP)();F.setMaxListeners(1e3);var O=null,R=new f.KU;R.setUnrecoverableErrorHandler(S),D&&(R.onFirewallDenied=D);R.onDebugLog((function(e){if("breadcrumb"===e.type){var n;n="container:state"===e.message?{containerState:e.data}:"data"in e?e.data:void 0,d.n_({category:"crosisV6",message:e.message,data:n}),d.n_({category:"crosisV6",message:e.message,data:n});var t={replid:null===O||void 0===O?void 0:O.repl.id,language:null===O||void 0===O?void 0:O.repl.language};switch(e.message){case"timeout:hit":p.error("crosis connect timeout",t);break;case"onUnrecoverableError":var r=(0,o.Z)({errorMessage:e.data.message},t);p.error("crosis unrecoverable error",r);break;case"status:retrying":var i=e.data,s=i.error,c=(0,a.Z)(i,["error"]),l=(0,o.Z)({errorMessage:s.message},t,c);p.error("crosis retrying",l);break;case"status:connecting":case"status:reconnecting":var u=e.message.split(":")[1];p.info("crosis ".concat(u),(0,o.Z)({},t,"data"in e?e.data:void 0));break;case"websocket:polling fallback":p.info("crosis polling fallback",(0,o.Z)({},t))}}}));var M=window.location.search.includes("debug=1");return M&&R.onDebugLog((function(e){"log"===e.type&&C.log("in"===e.log.direction?"--\x3e":"<--",e.log.channel.service,{cmd:e.log.cmd,channel:e.log.channel})})),{logger:p,performance:k,onPortOpened:function(e){return F.on(v.z.PORT_OPEN,e),function(){F.removeListener(v.z.PORT_OPEN,e)}},onPortClosed:function(e){return F.on(v.z.PORT_CLOSE,e),function(){F.removeListener(v.z.PORT_CLOSE,e)}},onToast:function(e){return F.on(v.z.TOAST,e),function(){F.removeListener(v.z.TOAST,e)}},onConnectionStateChanged:function(e){return R.onConnectionStateChange(e)},connect:function(e){var l=this,d=e.context,h=e.customConnectionMetadata,g=e.fetchConnectionMetadataExtras,D=e.getMinimumRetryDelayMs,Z=(0,a.Z)(e,["context","customConnectionMetadata","fetchConnectionMetadataExtras","getMinimumRetryDelayMs"]);R.getConnectionState()!==v.e.DISCONNECTED&&R.close(),O=d;var P=null;x((function(){R.getConnectionState()===v.e.DISCONNECTED&&l.connect((0,o.Z)({context:d,customConnectionMetadata:h,fetchConnectionMetadataExtras:g,getMinimumRetryDelayMs:D},Z))}),(function(){R.getConnectionState()!==v.e.DISCONNECTED&&l.close({expectReconnect:!0})}));var N=this,L=function(){var e=(0,r.Z)((function(e){var n,t,r,i,a,s;return(0,c.__generator)(this,(function(c){switch(c.label){case 0:return n=e.chan0,t=e.gurl,r=e.isFirst,"open"!==n.status?[2]:(i=p.timeStart({gurl:t}),a=setTimeout((function(){p.error("ping with no response",{gurl:t}),N.connect((0,o.Z)({context:d,customConnectionMetadata:h,fetchConnectionMetadataExtras:g,getMinimumRetryDelayMs:D},Z))}),3e4),[4,n.request({ping:{}})]);case 1:return s=c.sent().channelClosed,clearTimeout(a),s?[2]:(r?i("latency to pid1",{type:"startup"}):E&&i("latency to pid1",{type:"periodic"}),setTimeout((function(){return L({chan0:n,gurl:t,isFirst:!1})}),1e3),[2])}}))}));return function(n){return e.apply(this,arguments)}}(),I={getNextRetryDelayMs:function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];var r=b.apply(void 0,(0,s.Z)(n)),o=D();return Math.max(r,o)},context:d,reuseConnectionMetadata:!0,fetchConnectionMetadata:function(){var e=(0,r.Z)((function(e){var r,a,s,l,u;return(0,c.__generator)(this,(function(c){switch(c.label){case 0:return"function"!==typeof _?[3,2]:[4,_()];case 1:c.sent(),c.label=2;case 2:return"function"!==typeof t?[3,4]:[4,t()];case 3:return a=c.sent(),[3,5];case 4:a=null,c.label=5;case 5:if(r=a,e.aborted)return[2,{error:f.gS.Aborted}];if(!r&&h&&P!==h.token)return P=h.token,[2,(0,i.Z)((0,o.Z)({},h),{error:null})];s=p.timeStart({hasCustomFetch:Boolean(Z.fetchConnectionMetadata)}),c.label=6;case 6:return c.trys.push([6,11,,12]),Z.fetchConnectionMetadata?[4,Z.fetchConnectionMetadata()]:[3,8];case 7:return l=c.sent(),[3,10];case 8:return[4,n((0,o.Z)({asViewer:d.asViewer,replId:d.repl.id,isLoggedIn:Boolean(d.currentUser),overrideClusterMetadata:r},g))];case 9:l=c.sent(),c.label=10;case 10:return[3,12];case 11:if(u=c.sent(),e.aborted)return[2,{error:f.gS.Aborted}];switch(u&&u.statusCode){case 400:case 401:case 403:throw new w.cb(u.statusCode);case 408:case 409:case 429:case 500:case 502:case 503:case 504:case 526:return p.warn("Retriable error while fetching connection metadata",{statusCode:u.statusCode,originalMessage:u.message}),[2,{error:f.gS.Retriable}]}throw u;case 12:return e.aborted?[2,{error:f.gS.Aborted}]:(M&&C.log("connecting",l),s("fetched connection metadata"),[2,(0,i.Z)((0,o.Z)({},l),{error:null})])}}))}));return function(n){return e.apply(this,arguments)}}(),pollingHost:"gp-v2.replit.com"};T&&T>0&&(I.timeout=T),(0,y.Z)()&&(I.pollingHost="gp-v2.firewalledreplit.com"),"undefined"===typeof WebSocket&&(I.WebSocketClass=u());var A=k.now(),B=0;R.open(I,(function(e){var n,t=e.channel;M&&C.log("connected",{replId:d.repl.id});var r=t.onCommand((function(e){switch(e.body){case"portOpen":if(!e.portOpen)throw new Error("portOpen only handles portOpen commands");var n=Boolean(e.portOpen.forwarded),t=e.portOpen.address,r=e.portOpen.port||0;if(5901===r)return;F.emit(v.z.PORT_OPEN,{port:r,externalPort:e.portOpen.externalPort,isVnc:5900===r,isForwarded:n,address:t});break;case"portClose":if(!e.portClose)throw new Error("portClose only handles portClose commands");var o=e.portClose.port||0,i=e.portClose.address;if(5901===o)return;F.emit(v.z.PORT_CLOSE,{port:o,externalPort:e.portClose.externalPort,isVnc:5900===o,address:i});break;case"protocolError":var a,s;S(new m.Z("goval panic").setExtra("message",null!==(s=null===(a=e.protocolError)||void 0===a?void 0:a.text)&&void 0!==s?s:"protocol error"));break;case"toast":var c,l=null===(c=e.toast)||void 0===c?void 0:c.text;if(!l)break;F.emit(v.z.TOAST,l)}}));L({chan0:t,gurl:null===(n=R.getConnectionMetadata())||void 0===n?void 0:n.gurl,isFirst:!0}),window.v6ws=R.ws;var o=k.now()-A;return p.info("connected to pid1",{time:o,reconnectCount:B,replid:d.repl.id,language:d.repl.language}),function(e){var n=e.willReconnect;r(),n?(A=k.now(),B++):O=null}}))},openChannel:function(e,n){return R.openChannel(e,(function(e){var t=e.channel.onCommand((function(e){var n,t;"protocolError"===e.body&&S(new m.Z("goval panic").setExtra("message",null!==(t=null===(n=e.protocolError)||void 0===n?void 0:n.text)&&void 0!==t?t:"protocol error"))})),r=n(e);return function(e){r&&r(e),t&&t()}}))},getConnectionState:function(){return R.getConnectionState()},exec:(0,r.Z)((function(){var e,n,t,r=arguments;return(0,c.__generator)(this,(function(o){for(e=r.length,n=new Array(e),t=0;t<e;t++)n[t]=r[t];return[2,h({client:R,args:n})]}))})),execWithEnv:function(){var e=(0,r.Z)((function(e){var n,t,r,o=arguments;return(0,c.__generator)(this,(function(i){for(n=o.length,t=new Array(n>1?n-1:0),r=1;r<n;r++)t[r-1]=o[r];return[2,h({client:R,args:t,env:e})]}))}));return function(n){return e.apply(this,arguments)}}(),close:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{expectReconnect:!1};R.getConnectionState()!==v.e.DISCONNECTED&&R.close(e)},destroy:function(){R.destroy(),F.removeAllListeners(),Z()},client:function(){return R},focus:function(){var e=R.getChannel(0);e&&e.send({focused:{}})},getConnectionMetadata:function(){return R.getConnectionMetadata()},getContext:function(){return O},getVncUrl:(0,r.Z)((function(){var e;return(0,c.__generator)(this,(function(n){switch(n.label){case 0:if(!(e=R.getConnectionMetadata())||R.getConnectionState()!==v.e.CONNECTED)throw new Error("Cannot get vnc url when container is not connected");return[4,l(e.token)];case 1:return[2,n.sent()]}}))})),unrecoverableError:function(e,n){R.destroy(),F.removeAllListeners(),S(n?m.Z.wrap(e).setExtras(n):e)}}}},67121:function(e,n,t){"use strict";t.d(n,{Gs:function(){return r},ZP:function(){return u},cb:function(){return f}});var r,o=t(66091),i=t(5683),a=t(2272),s=t(83451),c=t(45347);!function(e){e.NotFound="NotFound",e.NotAllowed="NotAllowed",e.ConcurrentReplLimit="ConcurrentReplLimit",e.FirewallDenied="FirewallDenied",e.LanguageTokenDenied="LanguageTokenDenied",e.RequiresRefresh="RequiresRefresh"}(r||(r={}));var l={"repl not found":r.NotFound,"not allowed to run at this time":r.NotAllowed,"language tokens are only for logged out people.":r.LanguageTokenDenied,"connect to unfirewalled repl from firewall mode":r.FirewallDenied,"user is required to refresh":r.RequiresRefresh};function u(e){var n=!0,t=!1,r=void 0;try{for(var o,i=Object.entries(l)[Symbol.iterator]();!(n=(o=i.next()).done);n=!0){var s=(0,a.Z)(o.value,2),c=s[0],u=s[1];if(e.message.toLowerCase().includes(c))return u}}catch(f){t=!0,r=f}finally{try{n||null==i.return||i.return()}finally{if(t)throw r}}return null}var f=function(e){(0,i.Z)(t,e);var n=(0,c.Z)(t);function t(e){return(0,o.Z)(this,t),n.call(this,"user is required to refresh: "+e)}return t}((0,s.Z)(Error))},18548:function(e,n,t){"use strict";t.d(n,{e:function(){return o.em},z:function(){return r}});var r,o=t(48262);!function(e){e.CONNECTION_STATE_CHANGE="CONNECTION_STATE_CHANGE",e.PORT_OPEN="PORT_OPEN",e.PORT_CLOSE="PORT_CLOSE",e.TOAST="TOAST"}(r||(r={}))},32628:function(e,n,t){"use strict";t.d(n,{Z:function(){return A}});var r=t(57135),o=t(72006),i=t(4405),a=t(55749),s=t(9970),c=t(96583),l=t(4561),u=t(22011),f=t(19499),d=t(70902),h=t(66091),p=t(5683),v=t(45347),g=t(72100),m=t(70090),y=t(51228),w=t(86763),C=t.n(w),E=t(70232);function b(e,n){var t=!0,r=!1,o=void 0;try{for(var i,a=n[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var s=i.value;switch(s){case l.Df.NotFound:if(e.includes("no such file"))return l.Df.NotFound;if(e.includes("file does not exist"))return l.Df.NotFound;break;case l.Df.AlreadyExists:if(e.includes("file exist"))return l.Df.AlreadyExists;break;case l.Df.NotDirectory:if(e.includes("not a directory"))return l.Df.NotDirectory;break;case l.Df.IsDirectory:if(e.includes("is a directory"))return l.Df.IsDirectory;break;case l.Df.InvalidPath:if(e.includes("absolute paths are not supported"))return l.Df.InvalidPath;break;case l.Df.DiskQuotaExceeded:if(e.includes("disk quota exceeded"))return l.Df.DiskQuotaExceeded;break;case l.Df.PermissionDenied:if(e.includes("permission denied"))return l.Df.PermissionDenied;break;case l.Df.FileSystemUnavailable:if(e.includes("input/output error"))return l.Df.FileSystemUnavailable;break;default:(0,E.Z)(s)}}}catch(c){r=!0,o=c}finally{try{t||null==a.return||a.return()}finally{if(r)throw o}}return null}var D=t(68282),S=t(87708);var k=t(68241),_=t(9353),x=t(70065),Z=function(e){(0,p.Z)(t,e);var n=(0,v.Z)(t);function t(e,a,s,p,v,g){var w;(0,h.Z)(this,t),(w=n.call(this)).writeChanges=function(e,n){if(!w.channel&&!w.isReconnecting)throw new Error("Trying to send changes before ever coming online");w.isReconnecting&&(w.didEditOffline=!0);var t=(0,D.ed)(e,w.localContent),r=t.op,i=t.docAfter;if(Math.random()<.1){var a=(0,D.f5)(y.type.apply(w.localContent,r)),s=e.apply((0,D.tT)(w.localContent));a===s.sliceString(0)&&a===(0,D.f5)(i)||w.onError("changeset to op mismatch",{originalError:null,changes:e,otContent:a,changeSetContent:s,docAfter:i})}var c,l="ghostwriter"===(null===(c=n)||void 0===c?void 0:c.author)?{author:f.api.OTPacket.Author.GHOSTWRITER}:{};w.metadata=(0,o.Z)({},w.metadata,l);try{w.pending=y.type.compose(w.pending,r)}catch(u){throw x.Z.wrap(u).setExtras({op:r,pending:w.pending})}w.localContent=i,0!==w.pending.length?w.emit("fileDirty"):w.commitPromise&&w.emit("commitStart"),w.debounceSend()},w.updateCursors=function(e){w.pendingCursors=e,w.debounceSend()},w.isClean=function(){return w.committedVersion===w.version&&0===w.inflight.length&&0===w.pending.length},w.onError=function(e,n){if(n.originalError){var t="string"===typeof n.originalError?n.originalError:n.originalError.message,r=b(t,[l.Df.NotFound,l.Df.IsDirectory,l.Df.DiskQuotaExceeded,l.Df.InvalidPath,l.Df.PermissionDenied,l.Df.FileSystemUnavailable]);if(r)return void w.emit("fsError",r,t)}w.destroy();var a=new Error("OT Error: "+e);w.emit("error",a,(0,i.Z)((0,o.Z)({},n),{filePath:w.linkedFile,version:w.version}))},w.sendOp=function(){if(w.channel&&"open"===w.channel.status&&!w.isReconnecting&&!(w.inflight.length>0)){if(0!==w.pending.length){var e=(0,D.gR)(w.pending);w.inflight=w.pending,w.pending=[],w.inflightOpsPromise=w.channel.request({ot:(0,o.Z)({spookyVersion:w.version,op:e},w.metadata)}),w.metadata={},w.inflightOpsPromise.then((function(n){n.error&&w.onError("error accepting packet",{originalError:n.error,op:e})}))}if(0!==w.pendingCursors.length){var n=!0,t=!1,r=void 0;try{for(var i,a=w.flushedCursorIds[Symbol.iterator]();!(n=(i=a.next()).done);n=!0){var s=i.value;w.channel.send({otDeleteCursor:{id:s}})}}catch(v){t=!0,r=v}finally{try{n||null==a.return||a.return()}finally{if(t)throw r}}w.flushedCursorIds=[];var c=!0,l=!1,u=void 0;try{for(var f,d=w.pendingCursors[Symbol.iterator]();!(c=(f=d.next()).done);c=!0){var h=f.value,p=Number(Math.random().toString().split(".")[1]).toString(36);w.flushedCursorIds.push(p),w.channel.send({otNewCursor:(0,o.Z)({id:p,user:w.user},h)})}}catch(v){l=!0,u=v}finally{try{c||null==d.return||d.return()}finally{if(l)throw u}}w.pendingCursors=[]}}},w.handlePacket=function(e,n){var t=e.op,r=e.version,o=e.crc32,i=n.overrideReconnectingBuffer;if(!w.isReconnecting||i)if(-1!==w.version){if(w.version++,r!==w.version){var a={originalError:null,expectedVersion:w.version,receivedVersion:r,incomingOp:t};return w.logger.error("OT Error: invalid server version",(0,k.P1)({details:a})),void w.onError("invalid server version",a)}try{w.serverContent=y.type.apply(w.serverContent,t)}catch(g){return void w.onError("unable to apply updated content",{originalError:g,incomingOp:t})}var s=m.str(w.serverContent)>>>0;if(s!==o){var c={originalError:null,incomingVersion:r,server:o,client:s,incomingOp:t};return w.logger.error("OT Error: crc32 mismatch",(0,k.P1)({details:c})),void w.onError("crc32 mismatch",c)}if(w.uncommittedOps.push({version:r,crc32:o,op:t}),w.dataloss&&w.shouldTrackDataLoss&&w.dataloss.storeOp({replId:w.replId,filePath:w.linkedFile.toString(),opType:"latestOp",op:{version:r,crc32:o},logger:w.logger,isReconnecting:w.isReconnecting}),JSON.stringify(t)===JSON.stringify(w.inflight))return w.dataloss&&w.shouldTrackDataLoss&&w.dataloss.storeOp({replId:w.replId,filePath:w.linkedFile.toString(),opType:"latestOwnOp",op:{version:r,crc32:o},logger:w.logger,isReconnecting:w.isReconnecting}),w.debounceCommit(),w.inflight=[],w.inflightOpsPromise=null,w.debounceSend(),void w.debounceSend.flush();if(w.commitPromise||w.emit("fileDirty"),w.debounceCommit(),w.hasUncommittedMultiplayerOps=!0,w.inflight.length){var l=y.type.transform(w.inflight,t,"right");t=y.type.transform(t,w.inflight,"left"),w.inflight=l}if(w.pending.length){var u=y.type.transform(w.pending,t,"right");t=y.type.transform(t,w.pending,"left"),w.pending=u}var f=(0,D.mt)(t,w.localContent),d=f.changes,h=f.docAfter;if(Math.random()<.1){var p=(0,D.f5)(y.type.apply(w.localContent,t)),v=d.apply((0,D.tT)(w.localContent));p===v.sliceString(0)&&p===(0,D.f5)(h)||w.onError("op to changeset mismatch",{originalError:null,op:t,otContent:p,changeSetContent:v,docAfter:h})}w.localContent=h,w.emit("changes",d)}else w.onError("Got packet while version is still -1, expected version to be set in handleStatus",{originalError:null});else w.bufferedReconnectingOps.push({crc32:o,op:t,version:r})},w.handleNewCursor=function(e){w.emit("cursor",e)},w.handleDeleteCursor=function(e){var n=e.id;w.emit("removeCursor",n)};var E=(0,d.Z)(w);w.handleStatus=function(){var e=(0,r.Z)((function(e){var n,t,r,o,i;return(0,c.__generator)(this,(function(a){switch(a.label){case 0:return E.channel&&"open"===E.channel.status?e.linkedFile?null==e.contents?(E.onError("expected status contents, got null or undefined",{originalError:null}),[2]):null==e.cursors?(E.onError("expected status cursors, got null or undefined",{originalError:null}),[2]):null==e.version?(E.onError("expected status version, got null or undefined",{originalError:null}),[2]):E.isReconnecting?(E.handleReconnect(e.contents,e.version),[2]):(E.dataloss&&E.shouldTrackDataLoss&&E.dataloss.checkAndTrack({serverContent:e.contents,serverVersion:e.version,replId:E.replId,filePath:E.linkedFile.toString(),fetchOps:E.fetchOps,logger:E.logger}),E.serverContent=e.contents,E.localContent=E.serverContent,E.version=e.version,E.emit("firstConnect"),E.emit("changes",S.as.of({from:0,insert:E.serverContent},0)),e.cursors.forEach(E.handleNewCursor),E.emit("fileDirty"),E.debounceCommit(),[2]):[4,E.channel.request({otLinkFile:{file:{path:E.linkedFile.toString()}}})]:[2];case 1:return(t=a.sent()).channelClosed?[2]:t.error?(E.onError("link file error "+t.error.replace(E.linkedFile.toString(),"$FILENAME"),{originalError:t.error}),[2]):t.otLinkFileResponse?(r=t.otLinkFileResponse.version,i=u.Z.from(null!==(o=null===(n=t.otLinkFileResponse.linkedFile)||void 0===n?void 0:n.content)&&void 0!==o?o:"").toString(),E.isReconnecting?(E.handleReconnect(i,r),[2]):(E.dataloss&&E.shouldTrackDataLoss&&E.dataloss.checkAndTrack({serverContent:i,serverVersion:r,replId:E.replId,filePath:E.linkedFile.toString(),fetchOps:E.fetchOps,logger:E.logger}),E.serverContent=i,E.localContent=E.serverContent,E.version=r,E.committedVersion=r,E.committedContent=E.serverContent,E.emit("firstConnect"),E.emit("changes",S.as.of({from:0,insert:E.serverContent},0)),[2])):(E.onError("unexpected link file response: "+JSON.stringify(t.toJSON()),{originalError:null}),[2])}}))}));return function(n){return e.apply(this,arguments)}}();var Z=(0,d.Z)(w);w.handleReconnect=function(){var e=(0,r.Z)((function(e,n){var t,r,a,s,l,u,f,d,h,p,v,g,m,w,C,E,b,D,S,x,T,F,O,R,M,P,N,L,I,A,B,U,V,q,W,Q,z,H,j,K,J,X,G,$,Y,ee,ne,te,re,oe,ie;return(0,c.__generator)(this,(function(c){switch(c.label){case 0:if(!Z.timeDisconnected)throw new Error("wat");if(t=Date.now()-Z.timeDisconnected,r={case:"other",remoteContent:e,localContent:Z.localContent},a=function(r){Z.reconnectTrackedData=(0,i.Z)((0,o.Z)({},r),{serverVersion:n,ourVersion:Z.version,ourCommittedVersion:Z.committedVersion,areContentsEqual:Z.serverContent===e,areCommittedContentsEqual:Z.committedContent===e,didReceiveOpsWhileReconnecting:Boolean(Z.bufferedReconnectingOps.length),didEditOffline:Z.didEditOffline,hasPendingOps:Boolean(Z.pending.length),disconnectDuration:t});var a={};"has_inflight_happy_path_ops_reached"===r.case&&Math.random()<.1&&(a={hasAdditionalLogs:!0,ourContent:String(Z.serverContent),ourCommittedContent:String(Z.committedContent),ourInflight:JSON.stringify(Z.inflight),ourPending:JSON.stringify(Z.pending),serverContent:String(e)}),Z.logger.info("OT Client: Reconnect",(0,k.P1)((0,o.Z)({},Z.reconnectTrackedData,a))),Z.track&&Z.track(_.U3.FILE_RECONNECTED_STATUS2,Z.reconnectTrackedData)},s=function(e,n){a({case:e,originCase:n,prompted:!1}),Z.isReconnecting=!1,Z.bufferedReconnectingOps=[],Z.didEditOffline=!1,Z.timeDisconnected=null,Z.debounceSend(),Z.debounceCommit(),Z.emit("transparentReconnect",{case:e,originCase:n})},l=function(t){if(r.remoteContent===r.localContent)return Z.version=n,Z.committedVersion=n,Z.localContent=e,Z.committedContent=e,Z.serverContent=e,Z.inflight=[],Z.pending=[],void s("unprompted_because_identical",t);a({case:t,prompted:!0}),r.case=t,Z.emit("promptUserReconnect",r)},Z.inflight.length){if(n===Z.version&&Z.serverContent===e)return Z.pending=y.type.compose(Z.inflight,Z.pending),Z.inflight=[],Z.inflightOpsPromise=null,s("has_inflight_happy_path_ops_unreached"),[2];u=!1,f=Z.serverContent;try{f=y.type.apply(f,Z.inflight)}catch(ae){u=!0}return u||Z.version+1!==n||f!==e?(l("has_inflight"),[2]):(l("has_inflight_happy_path_ops_reached"),[2])}if(Z.hasUncommittedMultiplayerOps)return l("multiplayer"),[2];if(Z.version===n)return e===Z.serverContent?(s("happy_path"),[2]):(l("same_version_different_content"),[2]);if(Z.committedVersion===n){d=e;try{h=!0,p=!1,v=void 0;try{for(g=Z.uncommittedOps[Symbol.iterator]();!(h=(m=g.next()).done);h=!0)w=m.value.op,d=y.type.apply(d,w)}catch(se){p=!0,v=se}finally{try{h||null==g.return||g.return()}finally{if(p)throw v}}}catch(ce){return l("same_committed_version_unable_to_apply_ops"),[2]}if(d===Z.serverContent){C=[],E=!0,b=!1,D=void 0;try{for(S=Z.uncommittedOps[Symbol.iterator]();!(E=(x=S.next()).done);E=!0)T=x.value.op,C=y.type.compose(C,T)}catch(se){b=!0,D=se}finally{try{E||null==S.return||S.return()}finally{if(b)throw D}}return Z.pending=y.type.compose(C,Z.pending),Z.uncommittedOps=[],Z.version=n,Z.serverContent=e,s("happy_path_uncommitted"),[2]}return l("same_committed_version_different_content_fixed"),[2]}return Z.version<n?[4,Z.fetchOps(Z.version+1,n)]:[3,3];case 1:F=c.sent(),O=!1,R=Z.serverContent;try{M=!0,P=!1,N=void 0;try{for(L=F[Symbol.iterator]();!(M=(I=L.next()).done);M=!0)A=I.value.op,R=y.type.apply(R,A)}catch(se){P=!0,N=se}finally{try{M||null==L.return||L.return()}finally{if(P)throw N}}}catch(le){O=!0}if(!O&&R===e){B=!0,U=!1,V=void 0;try{for(q=F[Symbol.iterator]();!(B=(W=q.next()).done);B=!0)Q=W.value,Z.handlePacket(Q,{overrideReconnectingBuffer:!0})}catch(se){U=!0,V=se}finally{try{B||null==q.return||q.return()}finally{if(U)throw V}}z=!0,H=!1,j=void 0;try{for(K=Z.bufferedReconnectingOps[Symbol.iterator]();!(z=(J=K.next()).done);z=!0)X=J.value,Z.handlePacket(X,{overrideReconnectingBuffer:!0})}catch(se){H=!0,j=se}finally{try{z||null==K.return||K.return()}finally{if(H)throw j}}return s("happy_path_server_ahead"),[2]}return[4,Z.fetchOps(Z.committedVersion+1,n)];case 2:G=c.sent(),$=!1,Y=Z.committedContent;try{ee=!0,ne=!1,te=void 0;try{for(re=G[Symbol.iterator]();!(ee=(oe=re.next()).done);ee=!0)ie=oe.value.op,Y=y.type.apply(Y,ie)}catch(se){ne=!0,te=se}finally{try{ee||null==re.return||re.return()}finally{if(ne)throw te}}}catch(ue){$=!0}return $||Y!==e?(l("uncommitted_server_ahead"),[2]):(l("happy_path_uncommitted_server_ahead"),[2]);case 3:return l("other"),[2]}}))}));return function(n,t){return e.apply(this,arguments)}}();var T=(0,d.Z)(w);w.flush=function(){var e=(0,r.Z)((function(e){return(0,c.__generator)(this,(function(n){switch(n.label){case 0:return[4,T.commitPromise];case 1:return n.sent(),T.debounceCommit(e),T.debounceCommit.flush(),[4,T.commitPromise];case 2:return n.sent(),[2]}}))}));return function(n){return e.apply(this,arguments)}}();var F=(0,d.Z)(w);w.fetchOps=function(){var e=(0,r.Z)((function(e,n){var t;return(0,c.__generator)(this,(function(r){switch(r.label){case 0:if(!F.channel)throw new Error("No channel, cannot fetchOps");return[4,F.channel.request({otFetchRequest:{versionFrom:e,versionTo:n}})];case 1:if((t=r.sent()).channelClosed)throw new Error("Channel closed while requesting");if(t.error)throw new Error("Fetch ops returned an error: "+t.error);if(!t.otFetchResponse)throw new Error("Expected otFetchResponse");if(!t.otFetchResponse.packets)throw new Error("Expected otFetchResponse.packets");return[2,t.otFetchResponse.packets.map((function(e){var n=e.crc32,t=e.op,r=e.version,o=e.userId,i=e.committed,a=e.author;if(null==n)throw new Error("Expected crc32 in packet");if(null==t)throw new Error("Expected op in packet");if(null==r)throw new Error("Expected version in packet");return{crc32:n,version:r,op:(0,D.ug)(t),userId:o,timestamp:i?1e3*i.seconds:0,author:a}}))]}}))}));return function(n,t){return e.apply(this,arguments)}}();var O=(0,d.Z)(w);w.fetchChanges=function(){var e=(0,r.Z)((function(e,n,t){var r,o;return(0,c.__generator)(this,(function(i){switch(i.label){case 0:return[4,O.fetchOps(e,n)];case 1:return r=i.sent(),o=t,[2,r.map((function(e){var n=e.op,t=e.version,r=e.userId,i=e.timestamp,a=e.crc32,s=(0,D.mt)(n,o),c=s.changes,l=s.docAfter,u=c.invert((0,D.tT)(o));return o=l,{changes:c,invertedChanges:u,userId:r,version:t,timestamp:i,crc32:a}}))]}}))}));return function(n,t,r){return e.apply(this,arguments)}}();var R=(0,d.Z)(w);w.transformSelection=function(){var e=(0,r.Z)((function(e){var n,t,r,o,i,a,s,l;return(0,c.__generator)(this,(function(c){switch(c.label){case 0:if(n=e.indexStart,t=e.indexEnd,r=e.versionFrom,o=e.versionTo,!R.channel)throw new Error("No channel, cannot transformSelection");return[4,R.channel.request({otTransformSelectionRequest:{indexStart:n,indexEnd:t,versionFrom:r,versionTo:o}})];case 1:if(!(i=c.sent()).otTransformSelectionResponse)throw new Error("Expected otTransformSelectionResponse");return[2,{indexStart:null!==(a=i.otTransformSelectionResponse.indexStart)&&void 0!==a?a:0,indexEnd:null!==(s=i.otTransformSelectionResponse.indexEnd)&&void 0!==s?s:0,version:null!==(l=i.otTransformSelectionResponse.version)&&void 0!==l?l:0}]}}))}));return function(n){return e.apply(this,arguments)}}(),w.getLocalContent=function(){return(0,D.f5)(w.localContent)},w.getRawLocalContent=function(){return w.localContent},w.shouldTrackDataLoss=!1,w.replId="",w.linkedFile=e,w.channel=null,w.inflight=[],w.inflightOpsPromise=null,w.uncommittedOps=[],w.hasUncommittedMultiplayerOps=!1,w.committedVersion=-1,w.isReconnecting=!1,w.bufferedReconnectingOps=[],w.didEditOffline=!1,w.pending=[],w.metadata={},w.version=-1,w.serverContent="",w.localContent="",w.committedContent="",w.flushedCursorIds=[],w.pendingCursors=[],w.user=null,w.flushFailed=0,w.debounceSend=C()((function(){return w.sendOp()}),20,{maxWait:60}),w.debounceCommit=C()((function(e){return w.commitToDisk(e)}),1e3,{maxWait:3e3}),w.commitPromise=null,w.timeDisconnected=null;var M=!1;return w.destroy=function(){M=!0},w.logger=p,w.track=g,w.dataloss=v,s.then((function(){M||(w.destroy=a.openChannel({service:"ot",name:"ot:".concat(e)},(function(n){var t=n.channel,r=n.context;return w.shouldTrackDataLoss=!window.navigator.userAgent.includes("Firefox"),w.replId=r.repl.id,w.dataloss&&w.shouldTrackDataLoss&&w.dataloss.ensureTrackedFile({replId:w.replId,filePath:e.toString()}),w.user=r.currentUser?{name:r.currentUser.username,id:r.currentUser.id}:null,w.channel=t,t.onCommand((function(e){switch(e.body){case"ot":var n,t,r;if(!e.ot||null==e.ot.op||null==e.ot.spookyVersion||null==e.ot.crc32)return void w.onError("missing data in ot packet",{originalError:null,op:null===(n=e.ot)||void 0===n?void 0:n.op,spookyVersion:null===(t=e.ot)||void 0===t?void 0:t.spookyVersion,crc32:null===(r=e.ot)||void 0===r?void 0:r.crc32});if(-1===w.version)return;var o={crc32:e.ot.crc32,op:(0,D.ug)(e.ot.op),version:e.ot.spookyVersion};return w.handlePacket(o,{overrideReconnectingBuffer:!1});case"otstatus":return w.handleStatus(e.otstatus);case"error":if(e.ref)return;return w.onError("Unknown protocol error OT channel",{originalError:e.error||"no error"});case"otNewCursor":return w.handleNewCursor(e.otNewCursor);case"otDeleteCursor":return w.handleDeleteCursor(e.otDeleteCursor)}})),function(){w.channel=null,w.isReconnecting=!0,w.debounceSend.cancel(),w.debounceCommit.cancel(),w.timeDisconnected||(w.timeDisconnected=Date.now())}})))})),w}return t.prototype.commitToDisk=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=this;return(0,r.Z)((function(){var t,r,o,i,a,s;return(0,c.__generator)(this,(function(c){switch(c.label){case 0:if(!n.channel)throw new Error("Tryna commit while offline");if("open"!==n.channel.status)return[2];if(n.isReconnecting)throw new Error("Committing while reconnecting");return n.isClean()?[2]:n.commitPromise?(n.debounceCommit(e),[2]):(t=function(){},n.commitPromise=new Promise((function(e){return t=e})),n.inflightOpsPromise?[4,n.inflightOpsPromise]:[3,2]);case 1:if(c.sent().channelClosed)return n.commitPromise=null,t(),[2];c.label=2;case 2:return n.pending.length>0?(n.debounceSend(),n.debounceSend.flush(),n.inflightOpsPromise?[4,n.inflightOpsPromise]:(n.commitPromise=null,t(),n.onError("expected inflight promise",{originalError:null}),[2])):[3,4];case 3:if(c.sent().channelClosed)return n.commitPromise=null,t(),[2];c.label=4;case 4:return n.emit("commitStart"),r=n.version,o=n.serverContent,[4,n.channel.request({flush:e})];case 5:return(i=c.sent()).channelClosed?(n.flushFailed=0,n.commitPromise=null,t(),[2]):"ok"!==i.body?(n.commitPromise=null,t(),a=i.error||i.toString(),b(a,[l.Df.NotFound,l.Df.AlreadyExists,l.Df.NotDirectory,l.Df.IsDirectory,l.Df.DiskQuotaExceeded])?(n.onError("unable to flush",{originalError:a}),[2]):(n.flushFailed++,setTimeout((function(){n.isReconnecting||n.channel&&"open"===n.channel.status&&n.debounceCommit(e)}),Math.min(Math.random()*(Math.pow(2,n.flushFailed)-1)*1e3,1e3*Math.pow(2,10))),[2])):(n.dataloss&&n.shouldTrackDataLoss&&(s=n.uncommittedOps[n.uncommittedOps.length-1])&&n.dataloss.storeOp({replId:n.replId,filePath:n.linkedFile.toString(),op:{crc32:s.crc32,version:s.version},opType:"latestFlushedOp",logger:n.logger,isReconnecting:n.isReconnecting}),n.uncommittedOps=[],n.hasUncommittedMultiplayerOps=!1,n.committedVersion=r,n.committedContent=o,n.flushFailed=0,n.emit("commitComplete",r),n.isClean()&&n.emit("fileClean"),n.commitPromise=null,t(),[2,i])}}))}))()},t}(g.EventEmitter),T=Z,F=t(20575),O=t(91926),R=t(43182),M=t(12290),P=t(61871),N=t(8082);var L=t(38931),I=t(92404);function A(e){var n,t=e.container,d=e.dataloss,h=e.track,p=e.channelRequestPriority,v=function(e){D=!0,$.push(e),X(),e.then((function(){var n=$.indexOf(e);n>-1&&$.splice(n,1),K()}))},g=function(e){var n=!0,t=!1,r=void 0;try{for(var o,i=V[Symbol.iterator]();!(n=(o=i.next()).done);n=!0){(0,o.value)(e)}}catch(a){t=!0,r=a}finally{try{n||null==i.return||i.return()}finally{if(t)throw r}}},y=function(e){var n=new T(e,t,Promise.all((0,s.Z)($).map((function(e){return e.catch((function(){}))}))).then((function(){})),t.logger,d,h);return n.on("commitComplete",K),n.on("fileDirty",X),n.on("fileClean",X),n.on("commitStart",X),n},w=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e4,n=function(n){for(var t=arguments.length,o=new Array(t>1?t-1:0),i=1;i<t;i++)o[i-1]=arguments[i];if(r.length>=e)throw new Error("fs: We retried too many things during a closed channel.");return new Promise((function(e){r.push(e)})).then((function(){return n.apply(void 0,(0,s.Z)(o))}))},t=function(){r.splice(0,r.length).forEach((function(e){return e()}))},r=[];return{enqueue:n,flush:t}}(),C=w.enqueue,E=w.flush,D=!1,k=null,_=null,x=null,Z=0,A=new Map,B=new Map,U=new Map,V=[];t.openChannel({service:"fsevents",priority:p},(function(e){var n=e.channel;k=n,n.onCommand((function(e){if("fileEvent"===e.body){if(!e.fileEvent)throw new Error("Expected fileEvent");var n=e.fileEvent,t=n.file,r=n.dest,o=n.op;if(t){var i=t.path;if(null!==i&&null!==o&&void 0!==i&&void 0!==o){var a,s=(0,I.S1)(i);if(K(),A.get(s)||t.type===f.api.File.Type.DIRECTORY)a=l.Tv.Directory;else{var c,u=Array.from(A.keys()).find((function(e){return(0,I.MO)(e,s)})),d=u&&(null===(c=A.get(u))||void 0===c?void 0:c.children.find((function(e){return e.filename===(0,I.Bf)(s)})));a=d?d.type:l.Tv.File}switch(o){case f.api.FileEvent.Op.Create:ne({eventType:l.kS.Create,node:{path:s,type:a}});break;case f.api.FileEvent.Op.Modify:if(a===l.Tv.Directory)break;ne({eventType:l.kS.Modify,node:{path:s,type:a}});break;case f.api.FileEvent.Op.Remove:ne({eventType:l.kS.Delete,node:{path:s,type:a}});break;case f.api.FileEvent.Op.Move:if(null==r||null==r.path)throw new Error("Expected dest path");var h=r.path;ne({eventType:l.kS.Move,node:{path:s,type:a},to:(0,I.S1)(h)})}}}}}));var t=(0,s.Z)(new Set((0,s.Z)(A.keys()).concat((0,s.Z)(B.keys()),(0,s.Z)(U.keys()))));return t.length&&n.send({subscribeFile:{files:t.map((function(e){return{path:e.toString()}}))}}),function(){k=null}}));var q=new Promise((function(e){return n=e}));t.openChannel({priority:p,service:function(e){return e.repl.currentUserPermissions.containerWrite?"gcsfiles":"files"}},(function(e){var t=e.channel;n(t),E();var r=(0,s.Z)(A.keys()).sort(),o=!0,i=!1,a=void 0;try{for(var c,u=function(){var e=c.value;oe.readDir(e).then((function(n){var t=A.get(e);if(t)if(n.error)ne({eventType:l.kS.Delete,node:{path:e,type:l.Tv.Directory}});else{var r=n.children,o=t.children,i=o.filter((function(e){return!r.some((function(n){return n.filename===e.filename&&n.type===e.type}))})),a=!0,s=!1,c=void 0;try{for(var u,f=i[Symbol.iterator]();!(a=(u=f.next()).done);a=!0){var d=u.value;ne({eventType:l.kS.Delete,node:{path:(0,I.K1)(e,d.filename),type:d.type}})}}catch(C){s=!0,c=C}finally{try{a||null==f.return||f.return()}finally{if(s)throw c}}var h=r.filter((function(e){return!o.some((function(n){return n.filename===e.filename&&n.type===e.type}))})),p=!0,v=!1,g=void 0;try{for(var m,y=h[Symbol.iterator]();!(p=(m=y.next()).done);p=!0){var w=m.value;ne({eventType:l.kS.Create,node:{path:(0,I.K1)(e,w.filename),type:w.type}})}}catch(C){v=!0,g=C}finally{try{p||null==y.return||y.return()}finally{if(v)throw g}}}}))},f=r[Symbol.iterator]();!(o=(c=f.next()).done);o=!0)u()}catch(y){i=!0,a=y}finally{try{o||null==f.return||f.return()}finally{if(i)throw a}}var d=!0,h=!1,p=void 0;try{for(var v,g=function(){var e=v.value;oe.readFile(e,{fromDisk:!0}).then((function(n){var t=U.get(e);t&&(n.error?ne({eventType:l.kS.Delete,node:{path:e,type:l.Tv.File}}):n.content.toBuffer().equals(t.latestContent.toBuffer())||ne({eventType:l.kS.Modify,node:{path:e,type:l.Tv.File}}))}))},m=U.keys()[Symbol.iterator]();!(d=(v=m.next()).done);d=!0)g()}catch(y){h=!0,p=y}finally{try{d||null==m.return||m.return()}finally{if(h)throw p}}return function(){q=new Promise((function(e){return n=e}))}}));var W=(0,P.Z)();W.promise.catch((function(e){return e}));var Q=(0,M.Z)((0,r.Z)((function(){var e;return(0,c.__generator)(this,(function(n){switch(n.label){case 0:return[4,W.promise];case 1:return[4,n.sent().request({fsSnapshot:{}})];case 2:return(e=n.sent()).channelClosed?[2,{success:!1,error:"channel closed"}]:e.error?[2,{success:!1,error:e.error}]:[2,{error:null,success:!0}]}}))})),{wait:5e3,maxWait:1e4});t.openChannel({service:"snapshot",skip:function(e){return!e.repl.currentUserPermissions.containerWrite}},(function(e){var n=e.channel;return W.resolve(n),function(){W.isFulfilled&&(W=(0,P.Z)()).promise.catch((function(e){return e}))}}));var z=l.kO.Clean,H=[],j=0;function K(){return J.apply(this,arguments)}function J(){return(J=(0,r.Z)((function(){var e;return(0,c.__generator)(this,(function(n){switch(n.label){case 0:return j++,X(),[4,oe.persist()];case 1:return(e=n.sent()).error&&L.kg.error("Failed to persist, something very bad has probably happened",{originalError:e.error}),j--,X(),[2]}}))}))).apply(this,arguments)}function X(){return G.apply(this,arguments)}function G(){return(G=(0,r.Z)((function(){var e,n;return(0,c.__generator)(this,(function(t){return e=0===j&&0===$.length&&Array.from(B.values()).every((function(e){return e.otClient.isClean()})),n=z===l.kO.Clean,e===n||(z=e?l.kO.Clean:l.kO.Syncing,H.forEach((function(e){e(z,{hasUserChanged:D})}))),[2]}))}))).apply(this,arguments)}var $=[];function Y(e,n){return ee.apply(this,arguments)}function ee(){return ee=(0,r.Z)((function(e,n){var t,o;return(0,c.__generator)(this,(function(i){return t=function(){var n=(0,r.Z)((function(){var n,r,o;return(0,c.__generator)(this,(function(i){switch(i.label){case 0:return[4,q];case 1:if("open"!==(n=i.sent()).status)return[2,C(t)];i.label=2;case 2:return i.trys.push([2,4,,5]),[4,n.request(e)];case 3:return r=i.sent(),[3,5];case 4:return o=i.sent(),R.Tb(new Error("Send request failed with error: ".concat(o))),[2,C(t)];case 5:return r.channelClosed?[2,C(t)]:[2,r]}}))}));return function(){return n.apply(this,arguments)}}(),o=t(),n.isMutative&&v(o),[2,o]}))})),ee.apply(this,arguments)}function ne(e){x=null;var n=(0,I.DH)(e.node.path),t=A.get(n),r=(0,I.Bf)(e.node.path);if(!r)throw new Error("Expected filename");var a=null;if(e.eventType===l.kS.Move){var c=(0,I.DH)(e.to);a=A.get(c)}if(t||a)switch(e.eventType){case l.kS.Create:if(!t)break;var u=(0,s.Z)(t.children.filter((function(e){return e.filename!==r}))).concat([{type:e.node.type,filename:r}]),f=!0,d=!1,h=void 0;try{for(var p,v=t.listeners[Symbol.iterator]();!(f=(p=v.next()).done);f=!0){(0,p.value.onChange)(u)}}catch(Ce){d=!0,h=Ce}finally{try{f||null==v.return||v.return()}finally{if(d)throw h}}t.children=u;break;case l.kS.Move:var g=(0,I.Bf)(e.to);if(t&&t===a){var m=(0,s.Z)(t.children.filter((function(e){return e.filename!==r&&e.filename!==g}))).concat([{type:e.node.type,filename:g}]),y=!0,w=!1,C=void 0;try{for(var E,b=t.listeners[Symbol.iterator]();!(y=(E=b.next()).done);y=!0){(0,E.value.onChange)(m)}}catch(Ce){w=!0,C=Ce}finally{try{y||null==b.return||b.return()}finally{if(w)throw C}}t.children=m;break}if(t){var D=t.children.filter((function(e){return e.filename!==r})),S=!0,k=!1,_=void 0;try{for(var Z,T=t.listeners[Symbol.iterator]();!(S=(Z=T.next()).done);S=!0){(0,Z.value.onChange)(D)}}catch(Ce){k=!0,_=Ce}finally{try{S||null==T.return||T.return()}finally{if(k)throw _}}t.children=D}if(a){var F=(0,s.Z)(a.children.filter((function(e){return e.filename!==r&&e.filename!==g}))).concat([{type:e.node.type,filename:g}]),O=!0,M=!1,P=void 0;try{for(var N,L=a.listeners[Symbol.iterator]();!(O=(N=L.next()).done);O=!0){(0,N.value.onChange)(F)}}catch(Ce){M=!0,P=Ce}finally{try{O||null==L.return||L.return()}finally{if(M)throw P}}a.children=F}break;case l.kS.Delete:if(!t)break;var V=t.children.filter((function(e){return e.filename!==r})),q=!0,W=!1,Q=void 0;try{for(var z,H=t.listeners[Symbol.iterator]();!(q=(z=H.next()).done);q=!0){(0,z.value.onChange)(V)}}catch(Ce){W=!0,Q=Ce}finally{try{q||null==H.return||H.return()}finally{if(W)throw Q}}t.children=V;break;case l.kS.Modify:break;default:throw new Error("unknown event")}switch(e.eventType){case l.kS.Move:case l.kS.Delete:var j=[B.get(e.node.path),U.get(e.node.path),A.get(e.node.path)],K=!0,J=!1,X=void 0;try{for(var G,$=j[Symbol.iterator]();!(K=(G=$.next()).done);K=!0){var Y=G.value;if(Y){var ee=!0,te=!1,re=void 0;try{for(var ie,ae=Y.listeners[Symbol.iterator]();!(ee=(ie=ae.next()).done);ee=!0){var se=ie.value,ce=se.onMoveOrDelete,le=se.dispose;ce&&ce(e),le()}}catch(Ce){te=!0,re=Ce}finally{try{ee||null==ae.return||ae.return()}finally{if(te)throw re}}}}}catch(Ce){J=!0,X=Ce}finally{try{K||null==$.return||$.return()}finally{if(J)throw X}}if(e.node.type===l.Tv.File)break;var ue=(0,s.Z)(new Set((0,s.Z)(A.keys()).concat((0,s.Z)(U.keys()),(0,s.Z)(B.keys())))).map((function(e){var n=B.get(e)||U.get(e)||A.get(e);if(!n)throw new Error("expected node");return n})),fe=[],de=!0,he=!1,pe=void 0;try{for(var ve,ge=ue.sort()[Symbol.iterator]();!(de=(ve=ge.next()).done);de=!0){var me=ve.value;if((0,I.X2)(e.node.path,me.path)){var ye=fe.slice(-1)[0];if(!ye||!(0,I.X2)(ye,me.path)){var we={eventType:l.kS.Delete,node:{path:me.path,type:me.type}};e.eventType===l.kS.Move&&(we=(0,i.Z)((0,o.Z)({},we),{eventType:l.kS.Move,to:(0,I.eB)(e.node.path,e.to,me.path)})),fe.push(me.path),ne(we)}}}}catch(Ce){he=!0,pe=Ce}finally{try{de||null==ge.return||ge.return()}finally{if(he)throw pe}}break;case l.kS.Create:case l.kS.Modify:if(!U.has(e.node.path))break;oe.readFile(e.node.path,{fromDisk:!0}).then((function(n){var t=U.get(e.node.path);if(t)if(n.error)ne({eventType:l.kS.Delete,node:{path:e.node.path,type:l.Tv.File}});else{t.latestContent=n.content;var r=!0,o=!1,i=void 0;try{for(var a,s=t.listeners[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var c=a.value.onChange;c&&c(n.content)}}catch(Ce){o=!0,i=Ce}finally{try{r||null==s.return||s.return()}finally{if(o)throw i}}}})).catch((function(e){e.message="File read after modify error: "+e.message,R.Tb(e)}))}}function te(){return te=(0,r.Z)((function(){var e,n,r,o,i,a,l,u,f;return(0,c.__generator)(this,(function(c){switch(c.label){case 0:if(!(o=null===(n=t.getContext())||void 0===n||null===(r=n.repl)||void 0===r?void 0:r.language))throw new Error("Expected repl language");return[4,(e=t).exec.apply(e,["rg","--hidden","--files"].concat((0,s.Z)(F.h.flatMap((function(e){return["--glob","!".concat(e)]})))))];case 1:return i=c.sent(),a=i.output,l=i.error,u=function(e){return!!e&&(!(0,F.C)(e)&&!O.ZP.isLangFileBinary(o,e))},!l&&a?[2,x={error:null,files:a.split("\n").filter(u)}]:l&&l.includes("not found")?[4,t.exec("find",".","-type","f","-print0")]:[3,3];case 2:if((f=c.sent()).output)return[2,x={error:null,files:f.output.slice(2,-1).split("\0./").filter(u)}];c.label=3;case 3:return"exit status 1"!==l&&R.Tb(new Error("Find file command failed with error: ".concat(l))),[2,{error:l,files:null}]}}))})),te.apply(this,arguments)}var re=function(){var e=(0,r.Z)((function(e,n,t){var o,i,a,s,u,f,d,h;function p(e){return v.apply(this,arguments)}function v(){return(v=(0,r.Z)((function(e){var n;return(0,c.__generator)(this,(function(t){switch(t.label){case 0:return[4,o.request(e)];case 1:if((n=t.sent()).channelClosed)throw new Error("channelClosed");if(n.error)throw new Error(n.error);return[2,n]}}))}))).apply(this,arguments)}return(0,c.__generator)(this,(function(r){switch(r.label){case 0:return[4,q];case 1:o=r.sent(),i={eventType:l.kS.Create,node:{path:e,type:l.Tv.File}},r.label=2;case 2:return r.trys.push([2,9,,10]),[4,p({transferStart:{path:e.toString(),size:n.length}})];case 3:if(!(a=r.sent().transfer))throw new Error("Failed to start a transfer (no transfer id)");s=n.toBuffer(),u=512e3,t(s.length,0),f=0,r.label=4;case 4:return f<Math.ceil(n.length/u)?[4,p({transferChunk:{id:a.id,content:s.subarray(f*u,(f+1)*u)}})]:[3,7];case 5:r.sent(),t(s.length,Math.min(s.length,(f+1)*u)),r.label=6;case 6:return f++,[3,4];case 7:return[4,p({transferComplete:{id:a.id,crc32:m.buf(s)}})];case 8:return r.sent(),[3,10];case 9:if("channelClosed"===(d=r.sent()).message)return[2,C(oe.transferFile,e,n,t)];if((h=b(d.message,[l.Df.NotDirectory,l.Df.AlreadyExists,l.Df.DiskQuotaExceeded]))===l.Df.DiskQuotaExceeded&&g(i),h===l.Df.AlreadyExists&&(h=l.Df.IsDirectory),h)return[2,{error:h}];throw d;case 10:return ne(i),[2,{error:null}]}}))}));return function(n,t,r){return e.apply(this,arguments)}}(),oe={getStatus:function(){return z},onStatusChange:function(e){return H.push(e),function(){var n=H.indexOf(e);n>-1&&H.splice(n,1)}},watchDir:function(e,n){var t=!1,r=function(){t=!0;var n=A.get(e);n&&(n.listeners=n.listeners.filter((function(e){return e.dispose!==r})),0===n.listeners.length&&A.delete(e))};return oe.readDir(e).then((function(a){if(!t){if(a.error){var s=new Error(a.error);return s.code=a.error,n.onError(s),void r()}var c=A.get(e);c||(c={path:e,type:l.Tv.Directory,children:a.children,listeners:[]},A.set(e,c),k&&k.send({subscribeFile:{files:[{path:e.toString()}]}})),c.listeners.push((0,i.Z)((0,o.Z)({},n),{dispose:r})),n.onChange(a.children)}})).catch((function(e){r(),n.onError(e)})),r},watchPathStat:function(e,n){var t=0,r=!1,o=function(i,s,c){if(s===l.Tv.File)return function(){};var u=(0,a.Z)(c),f=u[0],d=u.slice(1),h=f===e;if(h&&0!==d.length)throw new Error("Invariant: child is target but has more children");var p=null,v=oe.watchDir(i,{onChange:function(i){var a=i.find((function(e){return e.filename===(0,I.Bf)(f)}));if(!a)return r||(n.onNewStat({exists:!1}),r=!0),void(p&&(p.dispose(),p=null));if(p&&a.type!==p.node.type&&(p.dispose(),p=null),!p)if(h){var s=++t;oe.stat(e).then((function(e){s===t&&e.exists&&(n.onNewStat(e),r=!1,p={node:a,dispose:function(){}})}))}else p={node:a,dispose:o(f,a.type,d)}},onError:n.onError});return function(){null===p||void 0===p||p.dispose(),v()}},i=(0,a.Z)((0,I.nV)(e)),s=i[0],c=i.slice(1);return o(s,l.Tv.Directory,c)},watchFilePath:function(e,n){var t,r=function(e,t){if(0===t.length){var o=oe.watchFile((0,I.S1)(e),n);return function(){o()}}var i,a=t[0],s=!1,c=oe.watchDir((0,I.S1)(e),{onChange:function(n){var o=n.find((function(e){return e.filename.toString()===a}));if(!s&&o)return i=r("".concat(e,"/").concat(a),t.slice(1)),void(s=!0);s=!1},onMoveOrDelete:function(){null===i||void 0===i||i()},onError:function(){}});return function(){null===i||void 0===i||i(),c()}},o=e.toString().split("/"),i=!1,a=oe.watchDir((0,I.S1)(""),{onChange:function(e){var n=e.find((function(e){return e.filename.toString()===o[0]}));if(!i&&n)return t=r(o[0],o.slice(1)),void(i=!0);i=!1},onError:function(){}});return function(){null===t||void 0===t||t(),a()}},writeFile:function(e,n){return(0,r.Z)((function(){var t,r,o,i,a,s;return(0,c.__generator)(this,(function(c){switch(c.label){case 0:return r="string"===typeof n?u.Z.from(n).toBuffer():n.toBuffer(),[4,Y({write:{path:e.toString(),content:r}},{isMutative:!0})];case 1:if(o=c.sent(),a=null===(t=A.get((0,I.DH)(e)))||void 0===t?void 0:t.children.some((function(n){return n.filename===(0,I.Bf)(e)})),i=U.has(e)||B.has(e)||a?{eventType:l.kS.Modify,node:{path:e,type:l.Tv.File}}:{eventType:l.kS.Create,node:{path:e,type:l.Tv.File}},o.error){if((s=b(o.error,[l.Df.NotDirectory,l.Df.AlreadyExists,l.Df.DiskQuotaExceeded]))===l.Df.DiskQuotaExceeded&&g(i),s===l.Df.AlreadyExists&&(s=l.Df.IsDirectory),!s)throw new Error(o.error);return[2,{error:s}]}return ne(i),[2,{error:null}]}}))}))()},transferFile:function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return(0,r.Z)((function(){var e;return(0,c.__generator)(this,(function(t){return e=re.apply(void 0,(0,s.Z)(n)),v(e),[2,e]}))}))()},readFile:function(e){var n=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{fromDisk:!1}).fromDisk;return(0,r.Z)((function(){var t,r,o;return(0,c.__generator)(this,(function(i){switch(i.label){case 0:return!n&&(t=B.get(e))&&t.otClient.getRawLocalContent()&&!t.otClient.isReconnecting?[2,{content:u.Z.from(t.otClient.getRawLocalContent()),error:null}]:[4,Y({read:{path:e.toString()}},{isMutative:!1})];case 1:if((r=i.sent()).error){if(!(o=b(r.error,[l.Df.NotFound,l.Df.IsDirectory])))throw new Error(r.error);return[2,{error:o}]}if(!r.file||!r.file.path||!r.file.content)throw new Error("Expected file");return[2,{content:u.Z.from(r.file.content),error:null}]}}))}))()},createDir:function(e){return(0,r.Z)((function(){var n,t,r;return(0,c.__generator)(this,(function(o){switch(o.label){case 0:return[4,Y({mkdir:{path:e.toString()}},{isMutative:!0})];case 1:if(n=o.sent(),t={eventType:l.kS.Create,node:{path:e,type:l.Tv.Directory}},n.error){if((r=b(n.error,[l.Df.NotDirectory,l.Df.DiskQuotaExceeded]))===l.Df.DiskQuotaExceeded&&g(t),!r)throw new Error(n.error);return[2,{error:r}]}return ne(t),[2,{error:null}]}}))}))()},moveDir:function(e,n){return(0,r.Z)((function(){var t,r,o;return(0,c.__generator)(this,(function(i){switch(i.label){case 0:return[4,Y({move:{oldPath:e.toString(),newPath:n.toString()}},{isMutative:!0})];case 1:if(t=i.sent(),r={eventType:l.kS.Move,node:{path:e,type:l.Tv.Directory},to:n},t.error){if((o=b(t.error,[l.Df.NotFound,l.Df.AlreadyExists,l.Df.NotDirectory,l.Df.DiskQuotaExceeded]))===l.Df.DiskQuotaExceeded&&g(r),!o)throw new Error(t.error);return[2,{error:o}]}return ne(r),[2,{error:null}]}}))}))()},moveFile:function(e,n){return(0,r.Z)((function(){var t,r,o;return(0,c.__generator)(this,(function(i){switch(i.label){case 0:return[4,Y({move:{oldPath:e.toString(),newPath:n.toString()}},{isMutative:!0})];case 1:if(t=i.sent(),r={eventType:l.kS.Move,node:{path:e,type:l.Tv.File},to:n},t.error){if((o=b(t.error,[l.Df.NotFound,l.Df.AlreadyExists,l.Df.NotDirectory,l.Df.DiskQuotaExceeded]))===l.Df.DiskQuotaExceeded&&g(r),!o)throw new Error(t.error);return[2,{error:o}]}return ne(r),[2,{error:null}]}}))}))()},copyFile:function(e,n){return(0,r.Z)((function(){var t;return(0,c.__generator)(this,(function(r){switch(r.label){case 0:return[4,oe.readFile(e)];case 1:return(t=r.sent()).error?[2,t]:[2,oe.writeFile(n,t.content)]}}))}))()},copyDirFromRemote:function(e,n,t){return(0,r.Z)((function(){var r,o,i,a,s,u,f,d,h,p,v,g,m;return(0,c.__generator)(this,(function(c){switch(c.label){case 0:return[4,this.deleteDir(e)];case 1:return c.sent(),[4,t.readDir(e)];case 2:return(r=c.sent()).error?[2,r]:[4,this.readDir(n)];case 3:return(o=c.sent()).error!==l.Df.NotFound?[3,5]:[4,this.createDir(e)];case 4:return c.sent(),[3,6];case 5:if(o.error===l.Df.NotDirectory)return[2,o];c.label=6;case 6:i=!0,a=!1,s=void 0,c.label=7;case 7:c.trys.push([7,15,16,17]),u=r.children[Symbol.iterator](),c.label=8;case 8:return(i=(f=u.next()).done)?[3,14]:(d=f.value,h=(0,I.K1)(e,d.filename),d.type!==l.Tv.File?[3,11]:[4,t.readFile(h)]);case 9:return(p=c.sent()).error?[2,p]:[4,this.writeFile((0,I.K1)(n,d.filename),p.content)];case 10:return(v=c.sent()).error?[2,v]:[3,13];case 11:return d.type!==l.Tv.Directory?[3,13]:[4,this.copyDirFromRemote(h,(0,I.K1)(n,d.filename),t)];case 12:if((g=c.sent()).error)return[2,g];c.label=13;case 13:return i=!0,[3,8];case 14:return[3,17];case 15:return m=c.sent(),a=!0,s=m,[3,17];case 16:try{i||null==u.return||u.return()}finally{if(a)throw s}return[7];case 17:return[2,{error:null}]}}))})).apply(this)},copyFileFromRemote:function(e,n,t){return(0,r.Z)((function(){var r,o;return(0,c.__generator)(this,(function(i){switch(i.label){case 0:return[4,t.readFile(e)];case 1:return(r=i.sent()).error?[2,r]:[4,this.writeFile(n,r.content)];case 2:return(o=i.sent()).error?[2,o]:[2,{error:null}]}}))})).apply(this)},deleteFile:function(e){return(0,r.Z)((function(){var n,t;return(0,c.__generator)(this,(function(r){switch(r.label){case 0:return[4,Y({remove:{path:e.toString()}},{isMutative:!0})];case 1:if((n=r.sent()).error){if(!(t=b(n.error,[l.Df.NotFound])))throw new Error(n.error);return[2,{error:t}]}return ne({eventType:l.kS.Delete,node:{path:e,type:l.Tv.File}}),[2,{error:null}]}}))}))()},deleteDir:function(e){return(0,r.Z)((function(){var n,t;return(0,c.__generator)(this,(function(r){switch(r.label){case 0:return[4,Y({remove:{path:e.toString()}},{isMutative:!0})];case 1:if((n=r.sent()).error){if(!(t=b(n.error,[l.Df.NotFound])))throw new Error(n.error);return[2,{error:t}]}return ne({eventType:l.kS.Delete,node:{path:e,type:l.Tv.Directory}}),[2,{error:null}]}}))}))()},readDir:function(e){return(0,r.Z)((function(){var n,t,r;return(0,c.__generator)(this,(function(o){switch(o.label){case 0:return[4,Y({readdir:{path:e.toString()}},{isMutative:!1})];case 1:if((t=o.sent()).error){if(!(r=b(t.error,[l.Df.NotFound,l.Df.NotDirectory,l.Df.FileSystemUnavailable])))throw new Error(t.error);return[2,{error:r}]}if(!(null===(n=t.files)||void 0===n?void 0:n.files))throw new Error("Expected filesChannel");return[2,{children:t.files.files.map((function(e){if(!e.path)throw new Error("Expected path");return{filename:(0,I.Bf)((0,I.S1)(e.path)),type:e.type===f.api.File.Type.DIRECTORY?l.Tv.Directory:l.Tv.File}})),error:null}]}}))}))()},stat:function(e){return(0,r.Z)((function(){var n;return(0,c.__generator)(this,(function(t){switch(t.label){case 0:return[4,Y({stat:{path:e.toString()}},{isMutative:!1})];case 1:if((n=t.sent()).error)throw new Error(n.error);if(!n.statRes)throw new Error("expected stat result");return n.statRes.exists?n.statRes.type===f.api.File.Type.DIRECTORY?[2,{exists:!0,type:l.Tv.Directory,lastModified:new Date(1e3*n.statRes.modTime)}]:[2,{exists:!0,type:l.Tv.File,lastModified:new Date(1e3*n.statRes.modTime),byteLength:Number(n.statRes.size)}]:[2,{exists:!1}]}}))}))()},watchTextFile:function(e,n){var t=this,a=B.get(e);if(a||(a={path:e,type:l.Tv.File,listeners:[],otClient:y(e)},B.set(e,a)),!a)throw new Error("Expected watchedOtFile");var u=!1,f=!1,d=function(){},h=[],p=function(o){if(d(),!a)throw new Error("Expected watchedOtFile");var i=function(e){var t;return null===(t=n.onFlush)||void 0===t?void 0:t.call(n,e)};a.otClient.on("commitComplete",i);var m=function(){var e;return null===(e=n.onStatusChange)||void 0===e?void 0:e.call(n,l.KF.Dirty)};a.otClient.on("fileDirty",m);var w=function(){var e;return null===(e=n.onStatusChange)||void 0===e?void 0:e.call(n,l.KF.Clean)};a.otClient.on("fileClean",w);var C=function(){var e;return null===(e=n.onStatusChange)||void 0===e?void 0:e.call(n,l.KF.Syncing)};a.otClient.on("commitStart",C);var E=function(e){var t;return null===(t=n.onCursor)||void 0===t?void 0:t.call(n,e)};a.otClient.on("cursor",E);var b=function(e){var t;return null===(t=n.onRemoveCursor)||void 0===t?void 0:t.call(n,e)};a.otClient.on("removeCursor",b);var k=t,_=function(){var n=(0,r.Z)((function(n){var t,r,o,i,s,l,u,f,d,p,v;return(0,c.__generator)(this,(function(c){switch(c.label){case 0:if(!a)throw new Error("Expected watchedOtFile");return(t=a.otClient).destroy(),r=y(e),[4,new Promise((function(e,n){r.once("changes",(function(){return e()})),r.once("error",(function(e){return n(e)}))}))];case 1:if(c.sent(),o=t.getLocalContent(),i=r.getLocalContent(),s="local"===n?(0,N.F)(i,o):null,l="remote"===n?(0,N.F)(o,i):null,!a)throw new Error("Expected watchedOtFile");a.otClient=r,u=!0,f=!1,d=void 0;try{for(p=a.listeners[Symbol.iterator]();!(u=(v=p.next()).done);u=!0)(0,v.value.reregister)(l)}catch(m){f=!0,d=m}finally{try{u||null==p.return||p.return()}finally{if(f)throw d}}for(s&&r.writeChanges(s);h.length>0;){var g;null===(g=h.pop())||void 0===g||g({isDisposed:!1})}return[4,k.flush()];case 2:return c.sent(),[2]}}))}));return function(e){return n.apply(this,arguments)}}(),x=function(e){var t;return null===(t=n.onReconnectFail)||void 0===t?void 0:t.call(n,_,e)};a.otClient.on("promptUserReconnect",x),a.listeners[0].reregister===p&&a.otClient.on("promptUserReconnect",(function(){if(B.has(e)){if(!a)throw new Error("Expected watchedOtFile");a.listeners.some((function(e){return e.onReconnectFail}))||_("remote")}}));var Z=function(e,t){n.onError&&n.onError(e,t),v()};a.otClient.on("error",Z);var T=function(t,r){if(t===l.Df.DiskQuotaExceeded&&g({eventType:l.kS.Modify,node:{path:e,type:l.Tv.File}}),n.onError){var o=new Error(r);o.code=t,n.onError(o)}v()};a.otClient.on("fsError",T);var F=function(e,t){if(!a)throw new Error("Expected watchedOtFile");D=!0;var r=S.as.of(e,a.otClient.getLocalContent().length,"\n");a.otClient.writeChanges(r,t);var o=!0,i=!1,s=void 0;try{for(var c,u=a.listeners[Symbol.iterator]();!(o=(c=u.next()).done);o=!0){var f=c.value.onChange;f&&f!==n.onChange&&f({changes:r,changeSource:l.Fl.Local,version:a.otClient.version,latestContent:a.otClient.getLocalContent()})}}catch(d){i=!0,s=d}finally{try{o||null==u.return||u.return()}finally{if(i)throw s}}},O=function(){var e=(0,r.Z)((function(){return(0,c.__generator)(this,(function(e){return(null===a||void 0===a?void 0:a.otClient.isReconnecting)?[2,new Promise((function(e,n){a?h.push(e):n(new Error("Expected watchedOtFile"))}))]:[2,{isDisposed:u}]}))}));return function(){return e.apply(this,arguments)}}(),R=function(){for(;h.length>0;){var e;null===(e=h.pop())||void 0===e||e({isDisposed:!1})}};a.otClient.on("transparentReconnect",R);var M,P=function(){var e=(0,r.Z)((function(){var e,n,t,r,o,i=arguments;return(0,c.__generator)(this,(function(c){switch(c.label){case 0:for(e=i.length,n=new Array(e),t=0;t<e;t++)n[t]=i[t];if(!a)throw new Error("Expected watchedOtFile");c.label=1;case 1:return c.trys.push([1,3,,4]),[4,O()];case 2:return c.sent().isDisposed?[2,{isDisposed:!0,result:null}]:[3,4];case 3:if(o=c.sent(),u)return[2,{isDisposed:!0,result:null}];throw o;case 4:return[4,(r=a.otClient).fetchChanges.apply(r,(0,s.Z)(n))];case 5:return[2,{isDisposed:!1,result:c.sent()}]}}))}));return function(){return e.apply(this,arguments)}}(),L=function(){var e=(0,r.Z)((function(){var e,n,t,r,o=arguments;return(0,c.__generator)(this,(function(i){switch(i.label){case 0:for(e=o.length,n=new Array(e),t=0;t<e;t++)n[t]=o[t];if(!a)throw new Error("Expected watchedOtFile");return[4,O()];case 1:if(i.sent().isDisposed)throw new Error("File was disposed");return[2,(r=a.otClient).transformSelection.apply(r,(0,s.Z)(n))]}}))}));return function(){return e.apply(this,arguments)}}(),I=function(e){if(!a)throw new Error("Expected watchedOtFile");a.otClient.updateCursors(e)};(-1!==a.otClient.version&&setTimeout((function(){var e;if(!f){if(!a)throw new Error("Expected watchedOtFile");f=!0,null===(e=n.onReady)||void 0===e||e.call(n,{initialContent:a.otClient.getLocalContent(),writeChange:F,updateSelections:I,fetchChanges:P,transformSelection:L,version:a.otClient.version})}})),o)&&(null===(M=n.onChange)||void 0===M||M.call(n,{changes:o,changeSource:l.Fl.Container,version:a.otClient.version,latestContent:a.otClient.getLocalContent()}));var A=function(e){var t,r;if(!a)throw new Error("Expected watchedOtFile");if(!f)return f=!0,void(null===(r=n.onReady)||void 0===r||r.call(n,{initialContent:a.otClient.getLocalContent(),writeChange:F,updateSelections:I,fetchChanges:P,transformSelection:L,version:a.otClient.version}));null===(t=n.onChange)||void 0===t||t.call(n,{changes:e,changeSource:l.Fl.Container,version:a.otClient.version,latestContent:a.otClient.getLocalContent()})};a.otClient.on("changes",A),d=function(){if(!a)throw new Error("Expected watchedOtFile");a.otClient.removeListener("commitComplete",i),a.otClient.removeListener("fileDirty",m),a.otClient.removeListener("fileClean",w),a.otClient.removeListener("commitStart",C),a.otClient.removeListener("error",Z),a.otClient.removeListener("fsError",T),a.otClient.removeListener("changes",A),a.otClient.removeListener("cursor",E),a.otClient.removeListener("removeCursor",b),a.otClient.removeListener("promptUserReconnect",x),a.otClient.removeListener("transparentReconnect",R)},X()},v=function(){for(;h.length>0;){var n;null===(n=h.pop())||void 0===n||n({isDisposed:!0})}if(!u&&B.has(e)){if(u=!0,f=!0,d(),!a)throw new Error("Expected watchedOtFile");a.listeners=a.listeners.filter((function(e){return e.dispose!==v})),0===a.listeners.length&&(a.otClient.destroy(),B.delete(e))}};return a.listeners.push((0,i.Z)((0,o.Z)({},n),{dispose:v,reregister:p})),p(null),v},watchFile:function(e,n){var t=!1,r=function(){t=!0;var n=U.get(e);n&&(n.listeners=n.listeners.filter((function(e){return e.dispose!==r})),0===n.listeners.length&&U.delete(e))};return oe.readFile(e).then((function(a){if(!t){if(a.error){var s=new Error(a.error);return s.code=a.error,n.onError&&n.onError(s),void r()}var c=U.get(e);if(c||(c={path:e,type:l.Tv.File,listeners:[],latestContent:a.content},U.set(e,c),k&&k.send({subscribeFile:{files:[{path:e.toString()}]}})),!c)throw new Error("Expected watched file");c.listeners.push((0,i.Z)((0,o.Z)({},n),{dispose:r})),n.onChange(a.content)}})),r},listFiles:function(){return(0,r.Z)((function(){var e;return(0,c.__generator)(this,(function(n){switch(n.label){case 0:return x&&t.performance.now()-Z<1e4?[2,x]:(_||(_=function(){return te.apply(this,arguments)}(),Z=t.performance.now()),[4,_]);case 1:return e=n.sent(),_=null,[2,e]}}))}))()},flush:function(e){var n=[],t=!0,r=!1,o=void 0;try{for(var i,a=B.values()[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var c=i.value;null!==c.otClient.channel&&(c.otClient.isReconnecting||n.push(c.otClient.flush(e)))}}catch(l){r=!0,o=l}finally{try{t||null==a.return||a.return()}finally{if(r)throw o}}return Promise.all((0,s.Z)(n).concat((0,s.Z)($)).map((function(e){return e.catch((function(){}))}))).then((function(){}))},persist:function(e){var n=Q();return e&&e.skipDebounce&&Q.flush(),n},getOTVersion:function(e){var n=B.get(e);if(!n)throw new Error("No file with path ".concat(e," found."));return n.otClient.version},onDiskQuotaExceeded:function(e){return V.push(e),function(){V=V.filter((function(n){return n!==e}))}}};return oe}},68282:function(e,n,t){"use strict";t.d(n,{ed:function(){return a},f5:function(){return l},gR:function(){return o},mt:function(){return s},tT:function(){return u},ug:function(){return i}});var r=t(87708);function o(e){return e.map((function(e){return"object"===typeof e?{delete:e.d}:"number"===typeof e?{skip:e}:{insert:e}}))}function i(e){return e.map((function(e){if("delete"in e&&e.delete)return{d:e.delete};if("skip"in e&&e.skip)return e.skip;if("insert"in e&&"string"===typeof e.insert)return e.insert;throw new Error("Unexpected op type")}))}function a(e,n){var t=[],r=n,o=0,i=0,a=0,s=0,c=function(e){var t=e-i;if(e<i)throw new Error("expected changeset to be ordered");for(var r=i+a;r<i+t+a;r++){var o=n.charCodeAt(r);o>=55296&&o<=57343?(s++,r++):13===o&&10===n.charCodeAt(r+1)&&(a++,r++)}i+=t};return e.iterChanges((function(e,n,l,u,f){if(e>0){var d=i+a,h=d-s;c(e);var p=i+a,v=p-s;t.push(v-h),o+=p-d}if(e!==n){var g=i+a,m=g-s;c(n);var y=i+a,w=y-s;t.push({d:w-m});var C=y-g;r=r.slice(0,o)+r.slice(o+C)}if(f.length){var E=f.sliceString(0);t.push(E),r=r.slice(0,o)+E+r.slice(o),o+=E.length}})),{op:t,docAfter:r}}function s(e,n){var t,o=[],i=n,a=0,s=0,c=0,l=0,f=function(e){for(var t=s+c;t<s+e+c;t++){var r=n.charCodeAt(t);r>=55296&&r<=57343?(c++,t++):13===r&&10===n.charCodeAt(t+1)&&(l++,t++)}s+=e},d=!0,h=!1,p=void 0;try{for(var v,g=e[Symbol.iterator]();!(d=(v=g.next()).done);d=!0){var m=v.value;if("string"===typeof m){var y=m;i=i.slice(0,a)+y+i.slice(a),a+=y.length;var w=s+c;if(y.endsWith("\r")&&"\n"===n.slice(w,w+1)&&0===(y=y.slice(0,-1)).length)continue;var C=u(y),E=w-l;(null===t||void 0===t?void 0:t.to)===E?t.insert=t.insert?t.insert.append(C):C:(t={from:w-l,insert:C},o.push(t))}else if("number"===typeof m){var b=c;f(m),a+=m+(c-b)}else if("d"in m){var D=s+c,S=l;f(m.d);var k=s+c,_=k-D;i=i.slice(0,a)+i.slice(a+_);var x=D-S,Z=k-l;if("\r\n"===n.slice(D-1,D+1)&&(Z-=1)-(x+=1)<=0)continue;(null===t||void 0===t?void 0:t.to)===x?t.to=Z:(t={from:x,to:Z},o.push(t))}}}catch(F){h=!0,p=F}finally{try{d||null==g.return||g.return()}finally{if(h)throw p}}if(s+c!==n.length){var T=n.slice(s+c);l+=T.split("\r\n").length-1}return{changes:r.as.of(o,n.length-l),docAfter:i}}var c=/\r\n?|\n/;function l(e){return e.replaceAll("\r\n","\n").replaceAll("\r","\n")}function u(e){return r.xv.of(e.split(c))}},47840:function(){}}]);
//# sourceMappingURL=1457-d1c811f3c9053a14.js.map